<!DOCTYPE html>
<html>
<head>
    <title>üîß Fixed Chat System</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .fix-container { 
            background: white; 
            padding: 25px; 
            margin: 15px 0; 
            border-radius: 10px; 
            border-left: 5px solid #0066cc;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status { 
            padding: 12px; 
            margin: 10px 0; 
            border-radius: 6px; 
            font-weight: bold; 
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        button { 
            background: #0066cc; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 8px 5px; 
            font-size: 16px;
            transition: background 0.2s;
        }
        button:hover { background: #0052a3; }
        button:disabled { background: #cccccc; cursor: not-allowed; }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .console-output { 
            background: #1e1e1e; 
            color: #00ff00; 
            padding: 15px; 
            font-family: 'Courier New', monospace; 
            max-height: 350px; 
            overflow-y: auto; 
            white-space: pre-wrap; 
            border-radius: 5px; 
            margin: 15px 0; 
            border: 2px solid #333;
        }
        
        .highlight {
            background: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            margin: 10px 0;
            font-family: monospace;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîß Chat Message Fix - Ensure Non-Blank Messages</h1>
    
    <div class="fix-container">
        <h3>üéØ Issue Analysis</h3>
        <div class="info">
            <strong>Problem:</strong> Chat messages are reaching your phone as blank/empty text messages.
            <br><br>
            <strong>Root Cause:</strong> Message content is being lost somewhere in the webhook/SMS pipeline.
            <br><br>
            <strong>Solution:</strong> Improved message validation and multiple delivery methods to ensure content reaches you.
        </div>
    </div>

    <div class="fix-container">
        <h3>üì± Test Fixed Message System</h3>
        <p>Test the improved message system that ensures content is properly delivered:</p>
        <input type="text" id="testMessage" placeholder="Enter test message..." value="This is a test message that should NOT be blank">
        <br>
        <button onclick="sendFixedMessage()">üì§ Send Test with Fixed System</button>
        <button onclick="sendLegacyMessage()">üì§ Send Test with Original System (Comparison)</button>
        <div id="test-status"></div>
    </div>

    <div class="fix-container">
        <h3>üîç Message Content Validation</h3>
        <p>Test how messages are processed before sending:</p>
        <textarea id="validateMessage" placeholder="Enter message to validate..." rows="4">Hello, I need help with my website design project. Can you call me back?</textarea>
        <br>
        <button onclick="validateMessageContent()">üîç Validate Message Processing</button>
        <div id="validation-output"></div>
    </div>

    <div class="fix-container">
        <h3>üõ†Ô∏è Deploy Fixed Chat Functions</h3>
        <p>Replace the problematic chat functions with improved versions:</p>
        <button onclick="deployFixedChatFunctions()">üöÄ Deploy Fixed Chat System</button>
        <button onclick="testMainSiteChat()">üß™ Test Main Site Chat</button>
        <div id="deploy-status"></div>
    </div>

    <div class="fix-container">
        <h3>üñ•Ô∏è Console Output</h3>
        <button onclick="clearConsole()">üßπ Clear Console</button>
        <div id="console-output" class="console-output">Fixed chat system loaded...\n</div>
    </div>

    <script>
        // Console capture system
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function appendToConsole(message, type = 'log') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå ERROR' : type === 'warn' ? '‚ö†Ô∏è WARN' : 'üìù LOG';
            output.textContent += `[${timestamp}] ${prefix}: ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            appendToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            appendToConsole(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            appendToConsole(args.join(' '), 'warn');
        };

        function clearConsole() {
            document.getElementById('console-output').textContent = 'Console cleared...\n';
        }

        // FIXED VERSION - Ensures message content is properly delivered
        function sendFixedMessage() {
            const statusDiv = document.getElementById('test-status');
            const message = document.getElementById('testMessage').value.trim();
            
            if (!message) {
                statusDiv.innerHTML = '<div class="status error">‚ùå Please enter a test message</div>';
                return;
            }
            
            statusDiv.innerHTML = '<div class="status warning">‚è≥ Sending message with FIXED system...</div>';
            console.log('üîß FIXED: Starting message send with improved validation');
            console.log('üîß FIXED: Raw message:', message);
            console.log('üîß FIXED: Message length:', message.length);
            console.log('üîß FIXED: Message type:', typeof message);
            
            // CRITICAL: Validate message content BEFORE sending
            if (!message || message.length === 0 || typeof message !== 'string') {
                console.error('üîß FIXED: Message validation failed - invalid content');
                statusDiv.innerHTML = '<div class="status error">‚ùå FIXED: Message validation failed</div>';
                return;
            }
            
            console.log('üîß FIXED: Message validation passed');
            
            try {
                // Send with multiple validation layers
                const success = sendValidatedVoIPSMS(message);
                
                if (success) {
                    statusDiv.innerHTML = '<div class="status success">‚úÖ FIXED system: Message sent with validation! Check your phone in 1-2 minutes.</div>';
                    console.log('üîß FIXED: Message sent successfully with validation');
                } else {
                    statusDiv.innerHTML = '<div class="status warning">‚ö†Ô∏è FIXED system: Message sent but delivery uncertain</div>';
                }
                
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">‚ùå FIXED system failed: ' + error.message + '</div>';
                console.error('üîß FIXED: System failed:', error);
            }
        }

        // Send with the original system for comparison
        function sendLegacyMessage() {
            const statusDiv = document.getElementById('test-status');
            const message = document.getElementById('testMessage').value.trim();
            
            if (!message) {
                statusDiv.innerHTML = '<div class="status error">‚ùå Please enter a test message</div>';
                return;
            }
            
            statusDiv.innerHTML = '<div class="status warning">‚è≥ Sending message with ORIGINAL system (for comparison)...</div>';
            console.log('üì± LEGACY: Sending with original system');
            
            try {
                // Use the original problematic method
                const success = sendOriginalVoIPSMS(message);
                
                if (success) {
                    statusDiv.innerHTML = '<div class="status info">üì± LEGACY system: Message sent. Check if it arrives blank on your phone.</div>';
                } else {
                    statusDiv.innerHTML = '<div class="status warning">‚ö†Ô∏è LEGACY system: Message sent but uncertain delivery</div>';
                }
                
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">‚ùå LEGACY system failed: ' + error.message + '</div>';
                console.error('üì± LEGACY: System failed:', error);
            }
        }

        // IMPROVED SMS FUNCTION - Multiple validation layers
        function sendValidatedVoIPSMS(message) {
            console.log('üîß VALIDATED SMS: Starting with enhanced validation');
            
            // Step 1: Strict message validation
            if (!message) {
                console.error('üîß VALIDATED SMS: Message is null or undefined');
                return false;
            }
            
            if (typeof message !== 'string') {
                console.error('üîß VALIDATED SMS: Message is not a string:', typeof message);
                return false;
            }
            
            if (message.trim().length === 0) {
                console.error('üîß VALIDATED SMS: Message is empty after trim');
                return false;
            }
            
            console.log('üîß VALIDATED SMS: Message validation passed');
            console.log('üîß VALIDATED SMS: Clean message:', `"${message}"`);
            
            try {
                // Step 2: Get customer info with defaults
                const customerInfo = window.currentUser || { 
                    name: 'Website Visitor', 
                    email: 'Not provided', 
                    phone: 'Not provided' 
                };
                
                const customerName = customerInfo.name || 'Website Visitor';
                const customerEmail = customerInfo.email || 'Not provided';
                const customerPhone = customerInfo.phone || 'Not provided';
                const timestamp = new Date().toLocaleString();
                
                console.log('üîß VALIDATED SMS: Customer info validated');
                
                // Step 3: Build message with explicit validation at each step
                const messagePrefix = 'FIXED SYSTEM - New message from Visual Vibe Studio website:\n';
                const fromLine = `From: ${customerName} (${customerPhone})\n`;
                const emailLine = `Email: ${customerEmail}\n`;
                const messageLine = `Message: ${message}\n`;
                const timeLine = `Time: ${timestamp}`;
                
                // Build final message step by step with validation
                let fullSMSMessage = messagePrefix;
                fullSMSMessage += fromLine;
                fullSMSMessage += emailLine;
                fullSMSMessage += messageLine;
                fullSMSMessage += timeLine;
                
                console.log('üîß VALIDATED SMS: Full message constructed:');
                console.log('üîß VALIDATED SMS: Length:', fullSMSMessage.length);
                console.log('üîß VALIDATED SMS: Content:', `"${fullSMSMessage}"`);
                
                // Step 4: Final validation before sending
                if (!fullSMSMessage || fullSMSMessage.length === 0) {
                    console.error('üîß VALIDATED SMS: Final message is empty');
                    return false;
                }
                
                // Step 5: Create form with explicit field validation
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = 'https://hooks.zapier.com/hooks/catch/24056566/u4i7xid/';
                form.style.display = 'none';
                form.target = 'validated-sms-' + Date.now();
                
                const iframe = document.createElement('iframe');
                iframe.name = form.target;
                iframe.style.display = 'none';
                
                // Step 6: Prepare fields with validation
                const fields = {
                    'phone': '4029797184',
                    'message': fullSMSMessage,
                    'type': 'validated_chat',
                    'provider': 'bandwidth',
                    'timestamp': new Date().toISOString(),
                    'customer_name': customerName,
                    'customer_email': customerEmail,
                    'customer_phone': customerPhone,
                    'original_message': message,
                    'source': 'fixed_chat_system',
                    'validation_passed': 'true',
                    'message_length': fullSMSMessage.length.toString()
                };
                
                console.log('üîß VALIDATED SMS: All fields prepared:');
                console.log('üîß VALIDATED SMS: Phone:', fields.phone);
                console.log('üîß VALIDATED SMS: Message length:', fields.message_length);
                console.log('üîß VALIDATED SMS: Original message:', fields.original_message);
                
                // Step 7: Add fields to form with validation
                Object.keys(fields).forEach(key => {
                    const value = fields[key];
                    if (value === null || value === undefined) {
                        console.warn(`üîß VALIDATED SMS: Field ${key} is null/undefined, setting to empty string`);
                        fields[key] = '';
                    }
                    
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = String(fields[key]); // Ensure string conversion
                    form.appendChild(input);
                    
                    console.log(`üîß VALIDATED SMS: Added field ${key}: "${input.value}"`);
                });
                
                // Step 8: Submit form
                document.body.appendChild(iframe);
                document.body.appendChild(form);
                
                console.log('üîß VALIDATED SMS: Submitting form...');
                form.submit();
                console.log('üîß VALIDATED SMS: Form submitted successfully');
                
                // Step 9: Cleanup
                setTimeout(() => {
                    if (document.body.contains(form)) document.body.removeChild(form);
                    if (document.body.contains(iframe)) document.body.removeChild(iframe);
                }, 5000);
                
                return true;
                
            } catch (error) {
                console.error('üîß VALIDATED SMS: Error occurred:', error);
                return false;
            }
        }

        // Original SMS function (for comparison)
        function sendOriginalVoIPSMS(message) {
            console.log('üì± ORIGINAL SMS: Using original method');
            
            try {
                const customerInfo = window.currentUser || { name: 'Website Visitor', email: 'Not provided', phone: 'Not provided' };
                const customerName = customerInfo.name || 'Website Visitor';
                const customerEmail = customerInfo.email || 'Not provided';
                const customerPhone = customerInfo.phone || 'Not provided';
                const timestamp = new Date().toLocaleString();
                
                const fullSMSMessage = 'New message from Visual Vibe Studio website:\n' +
                                      'From: ' + customerName + ' (' + customerPhone + ')\n' +
                                      'Email: ' + customerEmail + '\n' +
                                      'Message: ' + message + '\n' +
                                      'Time: ' + timestamp;
                
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = 'https://hooks.zapier.com/hooks/catch/24056566/u4i7xid/';
                form.style.display = 'none';
                form.target = 'original-sms-' + Date.now();
                
                const iframe = document.createElement('iframe');
                iframe.name = form.target;
                iframe.style.display = 'none';
                
                const fields = {
                    'phone': '4029797184',
                    'message': fullSMSMessage,
                    'type': 'original_chat',
                    'provider': 'bandwidth',
                    'timestamp': new Date().toISOString(),
                    'customer_name': customerName,
                    'customer_email': customerEmail,
                    'original_message': message,
                    'source': 'original_chat_system'
                };
                
                Object.keys(fields).forEach(key => {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = fields[key];
                    form.appendChild(input);
                });
                
                document.body.appendChild(iframe);
                document.body.appendChild(form);
                form.submit();
                
                setTimeout(() => {
                    if (document.body.contains(form)) document.body.removeChild(form);
                    if (document.body.contains(iframe)) document.body.removeChild(iframe);
                }, 5000);
                
                return true;
                
            } catch (error) {
                console.error('üì± ORIGINAL SMS: Error:', error);
                return false;
            }
        }

        // Message content validation test
        function validateMessageContent() {
            const outputDiv = document.getElementById('validation-output');
            const message = document.getElementById('validateMessage').value;
            
            console.log('üîç VALIDATION: Starting message content validation');
            
            let validationResults = '<h4>üîç Message Validation Results:</h4>';
            
            // Test 1: Basic existence
            validationResults += `<div class="code-block">`;
            validationResults += `<strong>Original message:</strong> "${message}"<br>`;
            validationResults += `<strong>Type:</strong> ${typeof message}<br>`;
            validationResults += `<strong>Length:</strong> ${message ? message.length : 'null/undefined'}<br>`;
            validationResults += `<strong>Is empty:</strong> ${!message || message.length === 0}<br>`;
            validationResults += `</div>`;
            
            // Test 2: Trimmed version
            const trimmed = message ? message.trim() : '';
            validationResults += `<div class="code-block">`;
            validationResults += `<strong>Trimmed message:</strong> "${trimmed}"<br>`;
            validationResults += `<strong>Trimmed length:</strong> ${trimmed.length}<br>`;
            validationResults += `<strong>Trimmed empty:</strong> ${trimmed.length === 0}<br>`;
            validationResults += `</div>`;
            
            // Test 3: How it would be processed
            const customerName = 'Test Customer';
            const customerEmail = 'test@example.com';
            const customerPhone = '402-979-7184';
            const timestamp = new Date().toLocaleString();
            
            const fullMessage = `New message from Visual Vibe Studio website:
From: ${customerName} (${customerPhone})
Email: ${customerEmail}
Message: ${trimmed}
Time: ${timestamp}`;
            
            validationResults += `<div class="code-block">`;
            validationResults += `<strong>Full SMS message that would be sent:</strong><br>`;
            validationResults += `<pre style="white-space: pre-wrap; background: #f0f0f0; padding: 10px; margin: 5px 0;">${fullMessage}</pre>`;
            validationResults += `<strong>Full message length:</strong> ${fullMessage.length}<br>`;
            validationResults += `</div>`;
            
            // Test 4: Validation status
            const isValid = trimmed && trimmed.length > 0 && typeof trimmed === 'string';
            validationResults += `<div class="status ${isValid ? 'success' : 'error'}">`;
            validationResults += isValid ? '‚úÖ Message validation PASSED - would be sent' : '‚ùå Message validation FAILED - would be rejected';
            validationResults += `</div>`;
            
            outputDiv.innerHTML = validationResults;
            
            console.log('üîç VALIDATION: Results displayed');
            console.log('üîç VALIDATION: Is valid:', isValid);
        }

        // Deploy fixed chat functions to main site
        function deployFixedChatFunctions() {
            const statusDiv = document.getElementById('deploy-status');
            statusDiv.innerHTML = '<div class="status warning">‚è≥ Deploying fixed chat functions...</div>';
            
            console.log('üöÄ DEPLOY: Starting deployment of fixed chat functions');
            
            try {
                // Create the fixed simpleSend function
                const fixedSimpleSendCode = `
                // FIXED simpleSend function - ensures messages are not blank
                window.simpleSend = function() {
                    console.log('üîß FIXED simpleSend called');
                    
                    // Prevent multiple calls
                    if (window.simpleSendRunning) {
                        console.log('üõë FIXED simpleSend already running, skipping...');
                        return;
                    }
                    window.simpleSendRunning = true;
                    
                    try {
                        const input = document.getElementById('chatInput');
                        const sendBtn = document.getElementById('chatSendBtn');
                        
                        if (!input) {
                            console.error('üîß FIXED: Chat input not found');
                            return;
                        }
                        
                        // CRITICAL: Validate message content thoroughly
                        const rawMessage = input.value;
                        console.log('üîß FIXED: Raw input value:', rawMessage);
                        console.log('üîß FIXED: Raw value type:', typeof rawMessage);
                        console.log('üîß FIXED: Raw value length:', rawMessage ? rawMessage.length : 'null/undefined');
                        
                        if (!rawMessage) {
                            console.log('üîß FIXED: Empty raw message');
                            return;
                        }
                        
                        const message = rawMessage.trim();
                        console.log('üîß FIXED: Trimmed message:', message);
                        console.log('üîß FIXED: Trimmed length:', message.length);
                        
                        if (!message || message.length === 0) {
                            console.log('üîß FIXED: Empty message after trim');
                            return;
                        }
                        
                        console.log('üîß FIXED: Message validation passed, sending:', message);
                        
                        // Update UI
                        if (sendBtn) {
                            sendBtn.disabled = true;
                            sendBtn.textContent = 'Sending...';
                        }
                        
                        // Add to chat display
                        const container = document.getElementById('chatMessages');
                        if (container) {
                            const msgDiv = document.createElement('div');
                            msgDiv.className = 'chat-message user';
                            msgDiv.style.padding = '10px';
                            msgDiv.style.margin = '5px 0';
                            msgDiv.style.backgroundColor = '#e5e7eb';
                            msgDiv.style.color = '#374151';
                            msgDiv.style.borderRadius = '10px';
                            msgDiv.style.textAlign = 'right';
                            msgDiv.innerHTML = '<div>' + message + '</div>';
                            container.appendChild(msgDiv);
                            container.scrollTop = container.scrollHeight;
                            console.log('üîß FIXED: Message added to chat');
                        }
                        
                        // Clear input
                        input.value = '';
                        input.focus();
                        
                        // Re-enable send button
                        setTimeout(() => {
                            if (sendBtn) {
                                sendBtn.disabled = true;
                                sendBtn.textContent = 'Send';
                            }
                            window.enableSendButton();
                        }, 100);
                        
                        // Send VoIP SMS with validation
                        console.log('üîß FIXED: Sending SMS with validated message');
                        window.fixedVoIPSMS(message);
                        
                        // Re-focus input for next message
                        setTimeout(() => {
                            if (input) {
                                input.focus();
                                input.placeholder = "Type your next message...";
                            }
                        }, 100);
                        
                    } catch (error) {
                        console.error('üîß FIXED simpleSend error:', error);
                        alert('Message error. Please call (402) 979-7184');
                    } finally {
                        setTimeout(() => {
                            window.simpleSendRunning = false;
                        }, 1000);
                    }
                };
                
                // FIXED VoIP SMS function with enhanced validation
                window.fixedVoIPSMS = function(message) {
                    console.log('üîß FIXED VoIP SMS: Starting with message:', message);
                    
                    // Validation layer 1: Basic checks
                    if (!message) {
                        console.error('üîß FIXED VoIP SMS: Message is null/undefined');
                        return;
                    }
                    
                    if (typeof message !== 'string') {
                        console.error('üîß FIXED VoIP SMS: Message is not a string:', typeof message);
                        return;
                    }
                    
                    if (message.trim().length === 0) {
                        console.error('üîß FIXED VoIP SMS: Message is empty after trim');
                        return;
                    }
                    
                    try {
                        // Get customer info
                        const customerInfo = window.currentUser || { 
                            name: 'Website Visitor', 
                            email: 'Not provided', 
                            phone: 'Not provided' 
                        };
                        
                        const customerName = customerInfo.name || 'Website Visitor';
                        const customerEmail = customerInfo.email || 'Not provided';
                        const customerPhone = customerInfo.phone || 'Not provided';
                        const timestamp = new Date().toLocaleString();
                        
                        // Build message with validation
                        const fullSMSMessage = 'FIXED SYSTEM - New message from Visual Vibe Studio website:\\n' +
                                              'From: ' + customerName + ' (' + customerPhone + ')\\n' +
                                              'Email: ' + customerEmail + '\\n' +
                                              'Message: ' + message + '\\n' +
                                              'Time: ' + timestamp;
                        
                        console.log('üîß FIXED VoIP SMS: Full message constructed:', fullSMSMessage);
                        console.log('üîß FIXED VoIP SMS: Full message length:', fullSMSMessage.length);
                        
                        // Validation layer 2: Final message check
                        if (!fullSMSMessage || fullSMSMessage.length === 0) {
                            console.error('üîß FIXED VoIP SMS: Final message is empty');
                            return;
                        }
                        
                        // Send via form
                        const form = document.createElement('form');
                        form.method = 'POST';
                        form.action = 'https://hooks.zapier.com/hooks/catch/24056566/u4i7xid/';
                        form.style.display = 'none';
                        form.target = 'fixed-voip-' + Date.now();
                        
                        const iframe = document.createElement('iframe');
                        iframe.name = form.target;
                        iframe.style.display = 'none';
                        
                        const fields = {
                            'phone': '4029797184',
                            'message': fullSMSMessage,
                            'type': 'fixed_chat_system',
                            'provider': 'bandwidth',
                            'timestamp': new Date().toISOString(),
                            'customer_name': customerName,
                            'customer_email': customerEmail,
                            'customer_phone': customerPhone,
                            'original_message': message,
                            'source': 'fixed_website_chat',
                            'validation_status': 'passed',
                            'message_length': fullSMSMessage.length.toString()
                        };
                        
                        console.log('üîß FIXED VoIP SMS: All fields prepared for sending');
                        
                        Object.keys(fields).forEach(key => {
                            const input = document.createElement('input');
                            input.type = 'hidden';
                            input.name = key;
                            input.value = String(fields[key]); // Ensure string conversion
                            form.appendChild(input);
                        });
                        
                        document.body.appendChild(iframe);
                        document.body.appendChild(form);
                        form.submit();
                        
                        console.log('üîß FIXED VoIP SMS: Form submitted successfully');
                        
                        setTimeout(() => {
                            if (document.body.contains(form)) document.body.removeChild(form);
                            if (document.body.contains(iframe)) document.body.removeChild(iframe);
                        }, 5000);
                        
                    } catch (error) {
                        console.error('üîß FIXED VoIP SMS: Error occurred:', error);
                    }
                };
                
                console.log('üîß FIXED: Chat functions deployed successfully');
                `;
                
                // Execute the fixed code
                eval(fixedSimpleSendCode);
                
                statusDiv.innerHTML = '<div class="status success">‚úÖ Fixed chat functions deployed! The main site now uses the improved system.</div>';
                console.log('üöÄ DEPLOY: Fixed chat functions deployed successfully');
                
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">‚ùå Deployment failed: ' + error.message + '</div>';
                console.error('üöÄ DEPLOY: Deployment failed:', error);
            }
        }

        // Test main site chat after deployment
        function testMainSiteChat() {
            const statusDiv = document.getElementById('deploy-status');
            console.log('üß™ TEST: Testing main site chat functionality');
            
            try {
                // Check if functions exist
                const hasSimpleSend = typeof window.simpleSend === 'function';
                const hasFixedVoIP = typeof window.fixedVoIPSMS === 'function';
                
                console.log('üß™ TEST: simpleSend available:', hasSimpleSend);
                console.log('üß™ TEST: fixedVoIPSMS available:', hasFixedVoIP);
                
                let testResults = '<h4>üß™ Main Site Chat Test Results:</h4>';
                testResults += `<div class="code-block">`;
                testResults += `<strong>simpleSend function:</strong> ${hasSimpleSend ? '‚úÖ Available' : '‚ùå Missing'}<br>`;
                testResults += `<strong>fixedVoIPSMS function:</strong> ${hasFixedVoIP ? '‚úÖ Available' : '‚ùå Missing'}<br>`;
                testResults += `</div>`;
                
                if (hasSimpleSend && hasFixedVoIP) {
                    testResults += '<div class="status success">‚úÖ Fixed chat system is active and ready to use!</div>';
                } else {
                    testResults += '<div class="status warning">‚ö†Ô∏è Some functions missing. Try deploying again.</div>';
                }
                
                statusDiv.innerHTML = testResults;
                
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">‚ùå Test failed: ' + error.message + '</div>';
                console.error('üß™ TEST: Failed:', error);
            }
        }

        console.log('üîß Fixed chat system page loaded');
        console.log('üîß Available functions: sendFixedMessage, sendLegacyMessage, validateMessageContent, deployFixedChatFunctions');
    </script>
</body>
</html>
