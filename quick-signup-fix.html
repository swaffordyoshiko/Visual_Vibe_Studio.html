<!DOCTYPE html>
<html>
<head>
    <title>Quick Signup Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß Quick Signup Fix</h1>
    
    <div class="section">
        <h3>Step 1: Check Current Data</h3>
        <button onclick="inspectStorage()">üîç Inspect Storage</button>
        <div id="storage-info"></div>
    </div>
    
    <div class="section">
        <h3>Step 2: Clear Problematic Data</h3>
        <button onclick="clearUserData()" style="background: #dc3545; color: white;">üóëÔ∏è Clear All User Data</button>
        <div id="clear-result"></div>
    </div>
    
    <div class="section">
        <h3>Step 3: Test Signup</h3>
        <input type="email" id="testEmail" placeholder="test@example.com" value="test@example.com" style="width: 200px; padding: 8px;">
        <button onclick="testSignup()">üß™ Test Signup</button>
        <div id="test-result"></div>
    </div>
    
    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}" style="margin: 10px 0; padding: 10px; border-radius: 5px;">${message}</div>`;
        }
        
        function inspectStorage() {
            console.log('üîç Inspecting localStorage...');
            
            let report = '<h4>localStorage Contents:</h4>';
            
            // Check visualVibeUsers
            const usersData = localStorage.getItem('visualVibeUsers');
            report += `<strong>visualVibeUsers:</strong> ${usersData ? usersData.substring(0, 200) + '...' : 'null'}<br>`;
            
            if (usersData) {
                try {
                    const users = JSON.parse(usersData);
                    report += `<strong>Parsed users:</strong> ${users.length} entries<br>`;
                    users.forEach((user, i) => {
                        report += `  ${i + 1}. ${user.name || 'NO_NAME'} &lt;${user.email || 'NO_EMAIL'}&gt;<br>`;
                    });
                } catch (e) {
                    report += `<span class="error">‚ùå Error parsing users: ${e.message}</span><br>`;
                }
            }
            
            // Check currentUser
            const currentUser = localStorage.getItem('currentUser');
            report += `<strong>currentUser:</strong> ${currentUser ? currentUser.substring(0, 100) + '...' : 'null'}<br>`;
            
            // Check all keys
            report += '<strong>All localStorage keys:</strong><br>';
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.toLowerCase().includes('user') || key.toLowerCase().includes('vibe')) {
                    report += `  - ${key}<br>`;
                }
            }
            
            log('storage-info', report, 'info');
        }
        
        function clearUserData() {
            console.log('üóëÔ∏è Clearing all user data...');
            
            let cleared = [];
            
            // Remove specific keys
            ['visualVibeUsers', 'currentUser'].forEach(key => {
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    cleared.push(key);
                }
            });
            
            // Remove any other user-related keys
            for (let i = localStorage.length - 1; i >= 0; i--) {
                const key = localStorage.key(i);
                if (key && (key.toLowerCase().includes('user') || key.toLowerCase().includes('vibe'))) {
                    localStorage.removeItem(key);
                    cleared.push(key);
                }
            }
            
            // Clear window variables
            window.currentUser = null;
            
            const message = cleared.length > 0 
                ? `‚úÖ Cleared: ${cleared.join(', ')}`
                : '‚úÖ No user data found to clear';
                
            log('clear-result', message, 'success');
            console.log('‚úÖ User data cleared:', cleared);
        }
        
        function testSignup() {
            const email = document.getElementById('testEmail').value.trim();
            console.log('üß™ Testing signup for:', email);
            
            // Simulate signup process
            const users = JSON.parse(localStorage.getItem('visualVibeUsers') || '[]');
            console.log('üìä Current users:', users);
            
            // Check for duplicate
            const duplicate = users.find(u => u.email && u.email.toLowerCase() === email.toLowerCase());
            
            if (duplicate) {
                log('test-result', `‚ùå Duplicate found: ${duplicate.name} &lt;${duplicate.email}&gt;`, 'error');
                return;
            }
            
            // Create test user
            const newUser = {
                id: Date.now().toString(),
                name: 'Test User',
                email: email,
                password: 'password123',
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('visualVibeUsers', JSON.stringify(users));
            
            window.currentUser = {
                id: newUser.id,
                name: newUser.name,
                email: newUser.email,
                loginTime: new Date().toISOString()
            };
            localStorage.setItem('currentUser', JSON.stringify(window.currentUser));
            
            log('test-result', `‚úÖ Signup successful! Created account for ${newUser.name} &lt;${email}&gt;`, 'success');
            console.log('‚úÖ Test signup completed');
        }
        
        // Auto-inspect on load
        setTimeout(() => {
            inspectStorage();
        }, 500);
    </script>
</body>
</html>
