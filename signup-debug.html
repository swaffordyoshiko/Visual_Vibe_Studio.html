<!DOCTYPE html>
<html>
<head>
    <title>Signup Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin: 10px 0; }
        input { width: 300px; padding: 8px; margin: 5px 0; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .log { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; max-height: 400px; overflow-y: auto; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Signup Debug Test</h1>
    
    <div class="form-group">
        <input type="text" id="testName" placeholder="Full Name" value="Test User">
    </div>
    <div class="form-group">
        <input type="email" id="testEmail" placeholder="Email" value="test@example.com">
    </div>
    <div class="form-group">
        <input type="password" id="testPassword" placeholder="Password" value="password123">
    </div>
    <div class="form-group">
        <input type="password" id="testConfirmPassword" placeholder="Confirm Password" value="password123">
    </div>
    
    <button onclick="testSignup()">Test Signup</button>
    <button onclick="checkStorage()">Check Storage</button>
    <button onclick="clearStorage()">Clear Storage</button>
    <button onclick="createTestUser()">Create Test User</button>
    
    <div id="log" class="log"></div>
    
    <script src="immediate-signup-fix.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${type}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function testSignup() {
            log('üß™ Testing signup process...', 'info');
            
            const name = document.getElementById('testName').value.trim();
            const email = document.getElementById('testEmail').value.trim().toLowerCase();
            const password = document.getElementById('testPassword').value;
            const confirmPassword = document.getElementById('testConfirmPassword').value;
            
            log(`üìù Attempting signup: ${name} <${email}>`, 'info');
            
            // Check existing users first
            const users = JSON.parse(localStorage.getItem('visualVibeUsers') || '[]');
            log(`üë• Current users in storage: ${users.length}`, 'info');
            
            users.forEach((user, index) => {
                log(`   ${index + 1}. ${user.name} <${user.email}>`, 'info');
            });
            
            // Check for duplicates
            const existingUser = users.find(u => u.email.toLowerCase() === email);
            if (existingUser) {
                log(`‚ùå Duplicate found: ${existingUser.name} <${existingUser.email}>`, 'error');
            } else {
                log(`‚úÖ No duplicate found, proceeding with signup`, 'success');
            }
            
            // Test the actual signup function
            try {
                // Create mock form elements
                if (!document.getElementById('signUpName')) {
                    const mockForm = document.createElement('div');
                    mockForm.innerHTML = `
                        <input type="text" id="signUpName" value="${name}">
                        <input type="email" id="signUpEmail" value="${email}">
                        <input type="password" id="signUpPassword" value="${password}">
                        <input type="password" id="signUpConfirmPassword" value="${confirmPassword}">
                    `;
                    document.body.appendChild(mockForm);
                }
                
                // Call the signup function
                if (typeof window.handleSignUp === 'function') {
                    const mockEvent = { preventDefault: () => {} };
                    window.handleSignUp(mockEvent);
                } else {
                    log('‚ùå handleSignUp function not found', 'error');
                }
            } catch (error) {
                log(`‚ùå Signup error: ${error.message}`, 'error');
            }
        }
        
        function checkStorage() {
            log('üîç Checking localStorage...', 'info');
            
            const users = JSON.parse(localStorage.getItem('visualVibeUsers') || '[]');
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            
            log(`üë• Total users: ${users.length}`, 'info');
            users.forEach((user, index) => {
                log(`   ${index + 1}. ${user.name} <${user.email}> (ID: ${user.id})`, 'info');
            });
            
            if (currentUser) {
                log(`üë§ Current user: ${currentUser.name} <${currentUser.email}>`, 'info');
            } else {
                log(`üë§ No current user logged in`, 'info');
            }
            
            // Check for any other user-related keys
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.toLowerCase().includes('user') || key.toLowerCase().includes('vibe')) {
                    const value = localStorage.getItem(key);
                    log(`üîë Found key: ${key} = ${value.substring(0, 100)}...`, 'info');
                }
            }
        }
        
        function clearStorage() {
            log('üóëÔ∏è Clearing all storage...', 'info');
            localStorage.clear();
            window.currentUser = null;
            log('‚úÖ Storage cleared', 'success');
        }
        
        function createTestUser() {
            log('üë§ Creating test user...', 'info');
            
            const testUser = {
                id: Date.now().toString(),
                name: 'Existing User',
                email: 'existing@example.com',
                password: 'password123',
                orders: [],
                createdAt: new Date().toISOString()
            };
            
            const users = JSON.parse(localStorage.getItem('visualVibeUsers') || '[]');
            users.push(testUser);
            localStorage.setItem('visualVibeUsers', JSON.stringify(users));
            
            log(`‚úÖ Created test user: ${testUser.name} <${testUser.email}>`, 'success');
        }
        
        // Initialize
        log('üöÄ Signup debug test loaded', 'info');
        checkStorage();
    </script>
</body>
</html>
