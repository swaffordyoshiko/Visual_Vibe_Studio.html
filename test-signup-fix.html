<!DOCTYPE html>
<html>
<head>
    <title>Test Signup Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; }
        .form-group { margin: 15px 0; }
        input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { width: 100%; padding: 12px; margin: 10px 0; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .debug-btn { background: #6c757d; }
        .clear-btn { background: #dc3545; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Signup Fix Test</h1>
        
        <div class="status" id="status">
            Ready to test signup...
        </div>
        
        <div class="form-group">
            <input type="text" id="testName" placeholder="Full Name" value="Test User">
        </div>
        <div class="form-group">
            <input type="email" id="testEmail" placeholder="Email" value="test@example.com">
        </div>
        <div class="form-group">
            <input type="password" id="testPassword" placeholder="Password" value="password123">
        </div>
        <div class="form-group">
            <input type="password" id="testConfirm" placeholder="Confirm Password" value="password123">
        </div>
        
        <button onclick="testSignup()">ğŸš€ Test Signup</button>
        <button class="debug-btn" onclick="checkStorage()">ğŸ” Check Storage</button>
        <button class="clear-btn" onclick="clearAndRetry()">ğŸ—‘ï¸ Clear & Retry</button>
        
        <!-- Hidden form elements for testing -->
        <div style="display: none;">
            <form id="signUpForm">
                <input type="text" id="signUpName">
                <input type="email" id="signUpEmail">
                <input type="password" id="signUpPassword">
                <input type="password" id="signUpConfirmPassword">
            </form>
        </div>
    </div>
    
    <script src="immediate-signup-fix.js"></script>
    
    <script>
        function updateStatus(message, color = '#f8f9fa') {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.style.backgroundColor = color;
        }
        
        function testSignup() {
            console.log('ğŸ§ª Testing signup...');
            updateStatus('ğŸ§ª Testing signup...', '#d1ecf1');
            
            const name = document.getElementById('testName').value;
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            const confirm = document.getElementById('testConfirm').value;
            
            // Fill hidden form
            document.getElementById('signUpName').value = name;
            document.getElementById('signUpEmail').value = email;
            document.getElementById('signUpPassword').value = password;
            document.getElementById('signUpConfirmPassword').value = confirm;
            
            // Override alert to capture result
            const originalAlert = window.alert;
            window.alert = function(msg) {
                console.log('ğŸ“¢ Alert:', msg);
                if (msg.includes('successfully')) {
                    updateStatus('âœ… ' + msg, '#d4edda');
                } else if (msg.includes('already exists')) {
                    updateStatus('âŒ ' + msg, '#f8d7da');
                } else {
                    updateStatus('âš ï¸ ' + msg, '#fff3cd');
                }
                setTimeout(() => {
                    window.alert = originalAlert;
                }, 100);
            };
            
            // Test signup
            try {
                if (typeof window.handleSignUp === 'function') {
                    const mockEvent = { preventDefault: () => {} };
                    window.handleSignUp(mockEvent);
                } else {
                    updateStatus('âŒ handleSignUp function not found', '#f8d7da');
                }
            } catch (error) {
                updateStatus('âŒ Error: ' + error.message, '#f8d7da');
            }
        }
        
        function checkStorage() {
            console.log('ğŸ” Checking storage...');
            
            try {
                const users = JSON.parse(localStorage.getItem('visualVibeUsers') || '[]');
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
                
                let message = `ğŸ“Š Storage Status:<br>`;
                message += `ğŸ‘¥ Users: ${users.length}<br>`;
                
                users.forEach((user, index) => {
                    message += `   ${index + 1}. ${user.name} &lt;${user.email}&gt;<br>`;
                });
                
                if (currentUser) {
                    message += `ğŸ‘¤ Current: ${currentUser.name} &lt;${currentUser.email}&gt;`;
                } else {
                    message += `ğŸ‘¤ Current: None`;
                }
                
                updateStatus(message, '#e2e3e5');
            } catch (error) {
                updateStatus('âŒ Storage error: ' + error.message, '#f8d7da');
            }
        }
        
        function clearAndRetry() {
            console.log('ğŸ—‘ï¸ Clearing data and retrying...');
            
            if (typeof window.clearAuthData === 'function') {
                window.clearAuthData();
                updateStatus('ğŸ—‘ï¸ Data cleared. Try signup again.', '#d1ecf1');
            } else {
                localStorage.clear();
                window.currentUser = null;
                updateStatus('ğŸ—‘ï¸ Storage cleared manually. Try signup again.', '#d1ecf1');
            }
        }
        
        // Initialize
        setTimeout(() => {
            console.log('ğŸš€ Test page loaded');
            updateStatus('ğŸš€ Ready to test signup. Current functions available: ' + 
                        (typeof window.handleSignUp === 'function' ? 'âœ… handleSignUp' : 'âŒ handleSignUp') + ', ' +
                        (typeof window.clearAuthData === 'function' ? 'âœ… clearAuthData' : 'âŒ clearAuthData'));
            checkStorage();
        }, 1000);
    </script>
</body>
</html>
