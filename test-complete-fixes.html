<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Complete Fixes</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4">
      <h1 class="text-4xl font-bold text-gray-800 mb-8 text-center">Test Complete Fixes</h1>
      
      <!-- Test Status Dashboard -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold mb-4">üõ°Ô∏è Orders & Reviews</h3>
          <div id="ordersStatus" class="text-sm space-y-2">
            <div class="text-gray-600">Not tested yet</div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold mb-4">üë§ Profile System</h3>
          <div id="profileStatus" class="text-sm space-y-2">
            <div class="text-gray-600">Not tested yet</div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold mb-4">üîÑ Consistency Tests</h3>
          <div id="consistencyStatus" class="text-sm space-y-2">
            <div class="text-gray-600">Not tested yet</div>
          </div>
        </div>
      </div>
      
      <!-- Test Controls -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-semibold mb-6">Test Controls</h2>
        
        <!-- User Setup -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-4">User Setup</h3>
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <button onclick="createTestUser()" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors">
              Create Test User
            </button>
            <button onclick="signInTestUser()" class="bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition-colors">
              Sign In User
            </button>
            <button onclick="addTestData()" class="bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 transition-colors">
              Add Test Data
            </button>
            <button onclick="clearAllTestData()" class="bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 transition-colors">
              Clear All Data
            </button>
          </div>
        </div>
        
        <!-- Orders & Reviews Tests -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-4">Orders & Reviews Tests</h3>
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <button onclick="testShowOrders()" class="bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
              Test Show Orders
            </button>
            <button onclick="testDeleteFunctionality()" class="bg-orange-600 text-white px-4 py-3 rounded-lg hover:bg-orange-700 transition-colors">
              Test Delete Functions
            </button>
            <button onclick="testRefreshConsistency()" class="bg-teal-600 text-white px-4 py-3 rounded-lg hover:bg-teal-700 transition-colors">
              Test Refresh Consistency
            </button>
            <button onclick="testMultipleOpens()" class="bg-pink-600 text-white px-4 py-3 rounded-lg hover:bg-pink-700 transition-colors">
              Test Multiple Opens
            </button>
          </div>
        </div>
        
        <!-- Profile Tests -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-4">Profile Tests</h3>
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <button onclick="testProfileModal()" class="bg-cyan-600 text-white px-4 py-3 rounded-lg hover:bg-cyan-700 transition-colors">
              Test Profile Modal
            </button>
            <button onclick="testProfileSave()" class="bg-emerald-600 text-white px-4 py-3 rounded-lg hover:bg-emerald-700 transition-colors">
              Test Profile Save
            </button>
            <button onclick="testPictureUpload()" class="bg-violet-600 text-white px-4 py-3 rounded-lg hover:bg-violet-700 transition-colors">
              Test Picture Upload
            </button>
            <button onclick="testAutoOpenPrevention()" class="bg-rose-600 text-white px-4 py-3 rounded-lg hover:bg-rose-700 transition-colors">
              Test Auto-Open Prevention
            </button>
          </div>
        </div>
      </div>
      
      <!-- Current User Display -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h3 class="text-lg font-semibold mb-4">Current User Status</h3>
        <div id="userDisplay" class="bg-gray-50 p-4 rounded-lg">
          <div class="text-gray-600">No user signed in</div>
        </div>
      </div>
      
      <!-- Test Results Log -->
      <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold mb-4">Test Results Log</h3>
        <div id="testLog" class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm h-64 overflow-y-auto">
          <div>Test system initialized...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Picture in Corner -->
  <div class="fixed top-4 left-4 z-40">
    <div id="userProfilePicture" class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center text-lg text-gray-500 border-2 border-white shadow-lg">
      üë§
    </div>
  </div>

  <!-- Order History Modal -->
  <div id="orderHistoryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
    <div class="bg-white rounded-xl max-w-6xl w-full max-h-[95vh] overflow-y-auto shadow-2xl">
      <div class="flex justify-between items-center p-6 border-b border-gray-200">
        <h3 class="text-2xl font-bold text-gray-800">My Orders & Receipts</h3>
        <button onclick="closeOrderHistory()" class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div id="orderHistoryContent" class="p-6">
        <div class="text-center py-8 text-gray-500">
          <p>Loading your orders...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
    <!-- Content will be generated by the profile solution -->
  </div>

  <script>
    let testResults = [];
    let testUser = null;
    
    function logTest(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const typeSymbol = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
      const logMessage = `[${timestamp}] ${typeSymbol} ${message}`;
      
      testResults.push(logMessage);
      
      const logElement = document.getElementById('testLog');
      logElement.innerHTML += `<div class="${type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : type === 'warning' ? 'text-yellow-400' : 'text-blue-400'}">${logMessage}</div>`;
      logElement.scrollTop = logElement.scrollHeight;
      
      updateStatusDashboard();
    }
    
    function updateStatusDashboard() {
      const ordersStatus = document.getElementById('ordersStatus');
      const profileStatus = document.getElementById('profileStatus');
      const consistencyStatus = document.getElementById('consistencyStatus');
      
      // Orders status
      const ordersTests = testResults.filter(r => r.includes('Orders') || r.includes('Delete') || r.includes('Review'));
      ordersStatus.innerHTML = ordersTests.slice(-3).map(test => 
        `<div class="text-xs ${test.includes('‚úÖ') ? 'text-green-600' : test.includes('‚ùå') ? 'text-red-600' : 'text-gray-600'}">${test.split('] ')[1]}</div>`
      ).join('');
      
      // Profile status
      const profileTests = testResults.filter(r => r.includes('Profile') || r.includes('Picture') || r.includes('Save'));
      profileStatus.innerHTML = profileTests.slice(-3).map(test => 
        `<div class="text-xs ${test.includes('‚úÖ') ? 'text-green-600' : test.includes('‚ùå') ? 'text-red-600' : 'text-gray-600'}">${test.split('] ')[1]}</div>`
      ).join('');
      
      // Consistency status
      const consistencyTests = testResults.filter(r => r.includes('Refresh') || r.includes('Multiple') || r.includes('Consistency'));
      consistencyStatus.innerHTML = consistencyTests.slice(-3).map(test => 
        `<div class="text-xs ${test.includes('‚úÖ') ? 'text-green-600' : test.includes('‚ùå') ? 'text-red-600' : 'text-gray-600'}">${test.split('] ')[1]}</div>`
      ).join('');
    }
    
    function updateUserDisplay() {
      const userDisplay = document.getElementById('userDisplay');
      if (window.currentUser) {
        userDisplay.innerHTML = `
          <div class="space-y-2">
            <div><strong>Name:</strong> ${window.currentUser.name || 'Not set'}</div>
            <div><strong>Email:</strong> ${window.currentUser.email}</div>
            <div><strong>Company:</strong> ${window.currentUser.companyName || 'Not set'}</div>
            <div><strong>Phone:</strong> ${window.currentUser.phone || 'Not set'}</div>
            <div><strong>Profile Picture:</strong> ${window.currentUser.profilePicture ? 'Set' : 'Not set'}</div>
          </div>
        `;
      } else {
        userDisplay.innerHTML = '<div class="text-gray-600">No user signed in</div>';
      }
    }
    
    // Test Functions
    function createTestUser() {
      testUser = {
        id: 'test_' + Date.now(),
        email: 'test@visualvibestudio.com',
        firstName: 'Test',
        lastName: 'Customer',
        name: 'Test Customer',
        companyName: 'Test Company Inc.',
        phone: '(555) 123-4567',
        bio: 'This is a test user account for testing purposes.'
      };
      
      logTest('Test user created with complete profile data', 'success');
      updateUserDisplay();
    }
    
    function signInTestUser() {
      if (!testUser) {
        createTestUser();
      }
      
      window.currentUser = { ...testUser };
      logTest('Test user signed in successfully', 'success');
      updateUserDisplay();
    }
    
    function addTestData() {
      if (!window.currentUser) {
        logTest('Please sign in a test user first', 'error');
        return;
      }
      
      const sampleOrders = [
        {
          id: 'order_1',
          orderNumber: 'VVS-001',
          businessName: 'Logo Design for Startup',
          total: 299,
          status: 'completed',
          date: '2024-01-15',
          services: ['Logo Design', 'Brand Guidelines']
        },
        {
          id: 'order_2',
          orderNumber: 'VVS-002',
          businessName: 'Website Design Project',
          total: 899,
          status: 'in-progress',
          date: '2024-01-20',
          services: ['Website Design', 'UI/UX']
        }
      ];
      
      const sampleReviews = [
        {
          id: 'review_1',
          rating: 5,
          text: 'Excellent work on our logo! The team really understood our vision.',
          date: '2024-01-16',
          service: 'Logo Design'
        },
        {
          id: 'review_2',
          rating: 4,
          text: 'Great communication and professional service throughout the project.',
          date: '2024-01-18',
          service: 'Brand Guidelines'
        }
      ];
      
      const userKey = `user_${window.currentUser.email}`;
      const userData = {
        ...window.currentUser,
        orders: sampleOrders,
        reviews: sampleReviews
      };
      
      localStorage.setItem(userKey, JSON.stringify(userData));
      logTest(`Added ${sampleOrders.length} orders and ${sampleReviews.length} reviews`, 'success');
    }
    
    function clearAllTestData() {
      localStorage.clear();
      window.currentUser = null;
      testUser = null;
      logTest('All test data cleared', 'warning');
      updateUserDisplay();
    }
    
    function testShowOrders() {
      if (!window.currentUser) {
        logTest('Please sign in a test user first', 'error');
        return;
      }
      
      try {
        showOrderHistory();
        setTimeout(() => {
          const modal = document.getElementById('orderHistoryModal');
          const content = document.getElementById('orderHistoryContent');
          
          if (modal && !modal.classList.contains('hidden')) {
            if (content.innerHTML.includes('Orders') && content.innerHTML.includes('Reviews')) {
              logTest('Orders modal shows both orders AND reviews ‚úì', 'success');
            } else {
              logTest('Orders modal missing orders or reviews section', 'error');
            }
          } else {
            logTest('Orders modal failed to open', 'error');
          }
        }, 1000);
      } catch (error) {
        logTest(`Error testing show orders: ${error.message}`, 'error');
      }
    }
    
    function testDeleteFunctionality() {
      logTest('Testing delete functionality (simulated)', 'info');
      
      // Check if delete functions exist
      if (typeof window.actuallyDeleteOrder === 'function') {
        logTest('actuallyDeleteOrder function exists ‚úì', 'success');
      } else {
        logTest('actuallyDeleteOrder function missing', 'error');
      }
      
      if (typeof window.actuallyDeleteReview === 'function') {
        logTest('actuallyDeleteReview function exists ‚úì', 'success');
      } else {
        logTest('actuallyDeleteReview function missing', 'error');
      }
    }
    
    function testRefreshConsistency() {
      logTest('Testing refresh consistency...', 'info');
      
      let refreshCount = 0;
      const testRefresh = () => {
        refreshCount++;
        if (refreshCount < 3) {
          setTimeout(() => {
            location.reload();
          }, 1000);
        } else {
          logTest('Refresh consistency test completed', 'success');
        }
      };
      
      testRefresh();
    }
    
    function testMultipleOpens() {
      if (!window.currentUser) {
        logTest('Please sign in a test user first', 'error');
        return;
      }
      
      logTest('Testing multiple modal opens...', 'info');
      
      let openCount = 0;
      const testInterval = setInterval(() => {
        if (openCount < 5) {
          try {
            showOrderHistory();
            setTimeout(() => {
              closeOrderHistory();
            }, 200);
            openCount++;
          } catch (error) {
            logTest(`Error on open ${openCount}: ${error.message}`, 'error');
          }
        } else {
          clearInterval(testInterval);
          logTest('Multiple opens test completed ‚úì', 'success');
        }
      }, 500);
    }
    
    function testProfileModal() {
      if (!window.currentUser) {
        logTest('Please sign in a test user first', 'error');
        return;
      }
      
      try {
        openProfileModal();
        setTimeout(() => {
          const modal = document.getElementById('profileModal');
          if (modal && !modal.classList.contains('hidden')) {
            logTest('Profile modal opens on user click ‚úì', 'success');
            closeProfileModal();
          } else {
            logTest('Profile modal failed to open', 'error');
          }
        }, 500);
      } catch (error) {
        logTest(`Error testing profile modal: ${error.message}`, 'error');
      }
    }
    
    function testProfileSave() {
      logTest('Testing profile save functionality...', 'info');
      
      if (typeof window.saveCompleteProfile === 'function') {
        logTest('saveCompleteProfile function exists ‚úì', 'success');
      } else {
        logTest('saveCompleteProfile function missing', 'error');
      }
    }
    
    function testPictureUpload() {
      logTest('Testing picture upload functionality...', 'info');
      
      if (typeof window.openProfilePictureUpload === 'function') {
        logTest('openProfilePictureUpload function exists ‚úì', 'success');
      } else {
        logTest('openProfilePictureUpload function missing', 'error');
      }
    }
    
    function testAutoOpenPrevention() {
      logTest('Testing auto-open prevention...', 'info');
      
      // Check if modals are hidden on page load
      const profileModal = document.getElementById('profileModal');
      const orderModal = document.getElementById('orderHistoryModal');
      
      if (profileModal && profileModal.classList.contains('hidden')) {
        logTest('Profile modal correctly hidden on load ‚úì', 'success');
      } else {
        logTest('Profile modal auto-opened (should not happen)', 'error');
      }
      
      if (orderModal && orderModal.classList.contains('hidden')) {
        logTest('Orders modal correctly hidden on load ‚úì', 'success');
      } else {
        logTest('Orders modal auto-opened (should not happen)', 'error');
      }
    }
    
    // Mock functions for testing
    function openSignInModal() {
      logTest('Sign In Modal would open here (test mode)', 'info');
    }
    
    function openContactModal() {
      logTest('Contact Modal would open here (test mode)', 'info');
    }
    
    // Initialize
    logTest('Test system ready - all fixes loaded');
    updateUserDisplay();
    
    // Check if our solutions loaded
    setTimeout(() => {
      if (window.completeOrdersReviewsSolution) {
        logTest('Complete Orders & Reviews solution loaded ‚úì', 'success');
      } else {
        logTest('Complete Orders & Reviews solution missing', 'error');
      }
      
      if (window.completeProfileSolution) {
        logTest('Complete Profile solution loaded ‚úì', 'success');
      } else {
        logTest('Complete Profile solution missing', 'error');
      }
    }, 500);
    
  </script>
  
  <!-- Load the complete solutions -->
  <script src="complete-orders-reviews-solution.js"></script>
  <script src="complete-profile-solution.js"></script>
  
</body>
</html>
