<!DOCTYPE html>
<html>
<head>
    <title>Signup Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        input { padding: 8px; margin: 5px; width: 200px; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Signup Fix Verification Test</h1>
    
    <div class="test-section">
        <h3>üßπ Step 1: Clear All Data</h3>
        <button onclick="clearAllData()">Clear Storage</button>
        <div id="clear-result"></div>
    </div>
    
    <div class="test-section">
        <h3>üìù Step 2: Test New Signup</h3>
        <input type="text" id="name1" placeholder="Name" value="John Doe">
        <input type="email" id="email1" placeholder="Email" value="john@example.com">
        <input type="password" id="pass1" placeholder="Password" value="password123">
        <input type="password" id="confirmpass1" placeholder="Confirm" value="password123">
        <br>
        <button onclick="testSignup('test1')">Test Signup #1</button>
        <div id="test1-result"></div>
    </div>
    
    <div class="test-section">
        <h3>üîÑ Step 3: Test Duplicate Email</h3>
        <input type="text" id="name2" placeholder="Name" value="Jane Doe">
        <input type="email" id="email2" placeholder="Email" value="john@example.com">
        <input type="password" id="pass2" placeholder="Password" value="different123">
        <input type="password" id="confirmpass2" placeholder="Confirm" value="different123">
        <br>
        <button onclick="testSignup('test2')">Test Duplicate Email</button>
        <div id="test2-result"></div>
    </div>
    
    <div class="test-section">
        <h3>‚úÖ Step 4: Test Different Email</h3>
        <input type="text" id="name3" placeholder="Name" value="Jane Smith">
        <input type="email" id="email3" placeholder="Email" value="jane@example.com">
        <input type="password" id="pass3" placeholder="Password" value="password456">
        <input type="password" id="confirmpass3" placeholder="Confirm" value="password456">
        <br>
        <button onclick="testSignup('test3')">Test Different Email</button>
        <div id="test3-result"></div>
    </div>
    
    <div class="test-section">
        <h3>üìä Storage Status</h3>
        <button onclick="checkStorage()">Check Storage</button>
        <div id="storage-status"></div>
    </div>
    
    <div id="log" class="log"></div>
    
    <script src="immediate-signup-fix.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${type}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}">${message}</div>`;
        }
        
        function clearAllData() {
            log('üóëÔ∏è Clearing all data...', 'info');
            
            if (typeof window.clearAuthData === 'function') {
                window.clearAuthData();
                showResult('clear-result', '‚úÖ Storage cleared successfully', 'success');
                log('‚úÖ Used clearAuthData function', 'success');
            } else {
                localStorage.clear();
                window.currentUser = null;
                showResult('clear-result', '‚úÖ Storage cleared manually', 'success');
                log('‚úÖ Cleared storage manually', 'success');
            }
        }
        
        function testSignup(testId) {
            log(`üß™ Running ${testId}...`, 'info');
            
            const name = document.getElementById('name' + testId.slice(-1)).value;
            const email = document.getElementById('email' + testId.slice(-1)).value;
            const password = document.getElementById('pass' + testId.slice(-1)).value;
            const confirmPassword = document.getElementById('confirmpass' + testId.slice(-1)).value;
            
            log(`üìù Attempting signup: ${name} <${email}>`, 'info');
            
            // Create mock form elements if they don't exist
            if (!document.getElementById('signUpName')) {
                const mockForm = document.createElement('div');
                mockForm.style.display = 'none';
                mockForm.innerHTML = `
                    <input type="text" id="signUpName">
                    <input type="email" id="signUpEmail">
                    <input type="password" id="signUpPassword">
                    <input type="password" id="signUpConfirmPassword">
                `;
                document.body.appendChild(mockForm);
            }
            
            // Fill the form
            document.getElementById('signUpName').value = name;
            document.getElementById('signUpEmail').value = email;
            document.getElementById('signUpPassword').value = password;
            document.getElementById('signUpConfirmPassword').value = confirmPassword;
            
            // Override alert to capture results
            const originalAlert = window.alert;
            let alertMessage = '';
            window.alert = function(msg) {
                alertMessage = msg;
                log(`üì¢ Alert: ${msg}`, alertMessage.includes('successfully') ? 'success' : 'error');
            };
            
            try {
                if (typeof window.handleSignUp === 'function') {
                    const mockEvent = { preventDefault: () => {} };
                    window.handleSignUp(mockEvent);
                    
                    setTimeout(() => {
                        if (alertMessage.includes('successfully')) {
                            showResult(`${testId}-result`, `‚úÖ ${alertMessage}`, 'success');
                        } else if (alertMessage.includes('already exists')) {
                            showResult(`${testId}-result`, `‚ö†Ô∏è ${alertMessage}`, 'info');
                        } else if (alertMessage) {
                            showResult(`${testId}-result`, `‚ùå ${alertMessage}`, 'error');
                        } else {
                            showResult(`${testId}-result`, '‚ùì No response received', 'error');
                        }
                        
                        // Restore original alert
                        window.alert = originalAlert;
                    }, 100);
                } else {
                    showResult(`${testId}-result`, '‚ùå handleSignUp function not found', 'error');
                    log('‚ùå handleSignUp function not available', 'error');
                    window.alert = originalAlert;
                }
            } catch (error) {
                showResult(`${testId}-result`, `‚ùå Error: ${error.message}`, 'error');
                log(`‚ùå Test error: ${error.message}`, 'error');
                window.alert = originalAlert;
            }
        }
        
        function checkStorage() {
            log('üìä Checking storage status...', 'info');
            
            try {
                const users = JSON.parse(localStorage.getItem('visualVibeUsers') || '[]');
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
                
                let status = `üë• Users in storage: ${users.length}<br>`;
                users.forEach((user, index) => {
                    status += `   ${index + 1}. ${user.name} <${user.email}><br>`;
                });
                
                if (currentUser) {
                    status += `üë§ Current user: ${currentUser.name} <${currentUser.email}>`;
                } else {
                    status += `üë§ No current user logged in`;
                }
                
                showResult('storage-status', status, 'info');
                log(`üìä Storage: ${users.length} users, current: ${currentUser ? currentUser.name : 'none'}`, 'info');
            } catch (error) {
                showResult('storage-status', `‚ùå Error reading storage: ${error.message}`, 'error');
                log(`‚ùå Storage error: ${error.message}`, 'error');
            }
        }
        
        // Initialize
        setTimeout(() => {
            log('üöÄ Test environment loaded', 'info');
            log('üîç Available functions:', 'info');
            log(`   openSignInModal: ${typeof window.openSignInModal}`, 'info');
            log(`   openSignUpModal: ${typeof window.openSignUpModal}`, 'info');
            log(`   handleSignUp: ${typeof window.handleSignUp}`, 'info');
            log(`   clearAuthData: ${typeof window.clearAuthData}`, 'info');
            checkStorage();
        }, 500);
    </script>
</body>
</html>
